# Implicit dependencies
# - actions/checkout@v2
# - ./.github/actions/install-linux-build-deps
# - ./.github/actions/install-solana
# - ./.github/actions/install-rust

name: "Build: ${{ inputs.name }}"
inputs:
  name:
    description: The name of the program to build
    required: true
runs:
  using: 'composite'
  env:
    cache_id: program-${{ inputs.name }}
  steps:
    - uses: actions/cache@v3
      id: cache-program
      with:
        path: |
          ./${{ inputs.name }}/target/
          ./${{ inputs.name }}/program/target/
        key:
          ${{ env.cache_id }}-${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}-${{
          env.RUSTC_HASH }}
      working-directory: ./${{ inputs.name }}/program
      run: |
        mkdir -p ../../test-programs
        cargo +${{ env.RUST_STABLE }} build-bpf --version
        cargo +${{ env.RUST_STABLE }} build-bpf --bpf-out-dir ../../test-programs/
      shell: bash
